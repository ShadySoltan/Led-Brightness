#include "tm4c123gh6pm.h"

//Configure PWM module 1 channel 6 for the blue led pin PF2
void PWM1_CH6_PF2(void)
{
    //Enable PWM1 module clock
    SYSCTL_RCGCPWM_R |= (1<<1);

    //Enable Clock for PORTF
    SYSCTL_RCGCGPIO_R |= (1<<5);
    while((SYSCTL_PRGPIO_R & 0x20) == 0);

    //Use SystemClock for PWM 16MHz
    SYSCTL_RCC_R &= ~(1<<20);

    //Select Alternate function for PF2
    GPIO_PORTF_AFSEL_R |= (1<<2);

    //Select PWM mode for PF2
    GPIO_PORTF_PCTL_R = 0x00000500;

    //Enable the pin
    GPIO_PORTF_DEN_R |= (1<<2);

    //Disable the PWM channel 6 before configuration
    PWM1_3_CTL_R &= ~(1<<0);

    //Select DownCount mode
    PWM1_3_CTL_R &= ~(1<<1);

    //Configure the load value to be 1600 meaning that the frequency will be 10KHz
    PWM1_3_LOAD_R = 1600;

    //Set the DutyCycle
    PWM1_3_CMPA_R = 0;

    //When the PWM timer starts counting from 1600 it drives the PF2 to high
    PWM1_3_GENA_R |= (1<<2) | (1<<3);

    //When the counter reaches the compartorA it will drive the pin to low
    PWM1_3_GENA_R &= ~(1<<6);
    PWM1_3_GENA_R |= (1<<7); //Writing the value of 0x2 to bits 6 and 7

    //Enable the PWM block 3
    PWM1_3_CTL_R |= (1<<0);

    //Enable PWM channel 6 output
    PWM1_ENABLE_R |= (1<<6);
}

void delay(long d)
{
    while(d--);
}


void APP1(void) //Turning the blue led off and on in a smooth way by varying brightness
{
    uint16 i;
    PWM1_CH6_PF2();
    while (1)
    {
        for(i = 0; i < 1600; i++)
        {
            PWM1_3_CMPA_R = i;
            delay(1000);
        }

        delay(1000000);

        for(i = 1600; i > 0; i--)
        {
            PWM1_3_CMPA_R = i;
            delay(1000);
        }

        delay(1000000);
    }
}


void PWM1_CH7_PF3(void)
{
    // Enable clock for PWM module 1
    SYSCTL_RCGCPWM_R |= (1 << 1);

    // Enable System clock for Port F
    SYSCTL_RCGCGPIO_R |= (1 << 5);
    while ((SYSCTL_PRGPIO_R & 0x20) == 0); // Wait until Port F is ready

    // Directly feed the module 1 PWM with the system clock without pre-divider
    SYSCTL_RCC_R &= ~(1 << 20);

    // Configure PF3 as a PWM pin
    GPIO_PORTF_AFSEL_R |= (1 << 3); // Enable alternate function on PF3
    GPIO_PORTF_PCTL_R = (GPIO_PORTF_PCTL_R & 0xFFFF0FFF) | 0x00005000; // Select PWM mode for PF3 (M1PWM7)
    GPIO_PORTF_DEN_R |= (1 << 3);  // Digital enable for PF3
    GPIO_PORTF_DIR_R |= (1 << 3);  // Set PF3 as output
    GPIO_PORTF_AMSEL_R &= ~(1 << 3); // Disable analog mode on PF3

    // Configure the PWM1 Channel 7 (M1PWM7)
    PWM1_3_CTL_R = 0; // Disable the generator block during configuration

    // Configure PWM Generator A
    PWM1_3_GENA_R = (PWM_3_GENA_ACTCMPAD_ONE | PWM_3_GENA_ACTLOAD_ZERO); // Drive PF3 high on load, low on compare match

    // Set the PWM frequency to 10 kHz with the main system clock of 16 MHz
    PWM1_3_LOAD_R = (16000000 / 10000) - 1; // Load value for 10 kHz frequency

    // Set duty cycle to 50%
    PWM1_3_CMPA_R = PWM1_3_LOAD_R / 2; // Compare A value for 50% duty cycle

    // Enable PWM Generator 3
    PWM1_3_CTL_R |= (1 << 0); // Enable the generator block

    // Enable PWM output on Channel 7 (M1PWM7)
    PWM1_ENABLE_R |= (1 << 7); // Enable PWM1 output 7 (M1PWM7)
}


void APP2(void) //Turning the blue led off and on in a smooth way by varying brightness
{
    uint16 i;
    PWM1_CH7_PF3();
    while (1)
    {
        for(i = 0; i < 1600; i++)
        {
            PWM1_3_CMPA_R = i;
            delay(1000);
        }

        delay(1000000);

        for(i = 1600; i > 0; i--)
        {
            PWM1_3_CMPA_R = i;
            delay(1000);
        }

        delay(1000000);
    }
}

void main(void)
{
    PWM1_CH7_PF3();
    while(1)
    {

    }
}
